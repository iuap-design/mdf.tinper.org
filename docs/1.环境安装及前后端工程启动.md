<a name="054c2d8e"></a>
## 一、环境搭建

<a name="73de2120"></a>
### 准备工作

1. 下载并安装JDK：版本1.8及以上，安装后需配置环境变量JAVA_HOME，参考[JAVA开发环境配置](https://www.runoob.com/java/java-environment-setup.html)
1. 下载并安装Maven：版本3.2及以上，安装后需配置用友私有仓库地址详情[见WIKI](https://wiki.yonyou.com/pages/viewpage.action?pageId=134186331)开发环境配置部分
1. 下载并安装[Git](https://git-scm.com/)：版本2.0及以上
1. 下载并安装[Eclipse](https://www.eclipse.org/downloads/)或[IDEA](http://www.jetbrains.com/)集成开发环境：版本2018及以上，并配置JDK和Maven路径
1. 下载并安装[Node.js](https://nodejs.org/en/)：版本10.0及以上

<a name="lx9UG"></a>
## 二、后台工程启动

1.在IDE中配置jdk路径、maven路径<br />2.在GIT上clone下universal-mdf-runtime（包含doc、ucf-mdf-parent、ucf-mdf-fe三个目录）<br />3.在IDE中导入后端工程ucf-mdf-parent，或使用IDE直接导入GIT工程<br />4.新建一个mysql数据库，执行doc/scripts文件夹下的三个初始化SQL脚本<br />5.修改ucf-mdf-parent/ucf-mdf-conf工程中的配置文件mdd-db.properties，设置数据库访问链接信息

```
mdd.datasource.ds0.jdbc-url=jdbc:mysql://[dbhost]:3306/[dbname]?useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true&serverTimezone=GMT%2B8
mdd.datasource.ds0.username=[username]
mdd.datasource.ds0.password=[password]
```

6.打开ucf-mdf-parent/ucf-mdf-bootstrap工程中的配置文件application.properties文件，修改注册后的工程名称，防止影响其他的注册服务。

```
#spring基本配置
spring.application.name=common-mdf
spring.domain.name=ucf-mdf-domainName
```
修改端口号和上下文，防止与其他服务产生冲突

```
#配置容器相关参数
server.servlet.context-path=/
server.port=8888
```

7.执行ucf-mdf-bootstrap项目下com.yonyou.ucf.mdf.MDFApplication类启动项目<br />PS:使用IDEA启动失败的话，需修改启动参数<br />![image.png](http://design.yonyoucloud.com/static/yuque/0/2019/png/459064/1566530174205-35dc39cf-c24a-4916-a8e3-75bf009dabb5.png#align=left&display=inline&height=133&name=image.png&originHeight=126&originWidth=721&size=13323&status=done&width=758.9473779445872)

ucf后端项目运行依赖的mdd sdk使用说明详情见wiki:[MDD-SDK使用说明文档](https://uap.wiki.yonyou.com/pages/viewpage.action?pageId=88604942)

<a name="391731ae"></a>
## 三、前端项目启动


1.获取脚手架代码并安装依赖
```bash
git clone git@git.yonyou.com:yonyou-mdf/yonyou-mdf-scaffold.git
cd ucf-mdf-fe

npm install ynpm-tool -g
ynpm install
```

2.修改hosts配置<br />服务端默认集成diwork登录，所以需要设置设置本地host文件映射一个二级域名，一级域名需与diwork一致：yyuap.com。

（1）Windows 系统：在C:\Windows\System32\drivers\etc目录下的hosts文件中增加一个域名映射：

```bash
127.0.0.1 guo.yyuap.com
```

（2）Mac 系统：
```bash
vim /etc/hosts
# 在hosts文件进行如下配置
127.0.0.1 guo.yyuap.com
```
3.修改后端接口地址,打开mdf-app/src/web/common/config.env.js修改如下：

```
  default:
    base_url='http://guo.yyuap.com:8888';
```

> 注：可以使用测试daily环境，登录地址是：[https://u8c-daily.yyuap.com/](https://u8c-daily.yyuap.com/) 用于全局登录yyuap拿到cookies，登录后，修改base_url="http://ucf-org-center.daily.app.yyuap.com/ucf-org-center" ，这样就是使用组织中心的API接口进行访问，想使用NCC资产云的接口修改：base_url="http://ucf-mdd-amc-pointcheck.daily.app.yyuap.com" 使用NCC资产云接口


4.启动前后端服务进行开发调试

```bash
npm run debug:client
# windows用户：打开dos窗口--->项目根目录--->npm install --->npm run debug:client
npm run debug:server
# windows用户：打开dos窗口--->项目根目录 --->npm run debug:server
```

5.登录diwork测试环境

- 访问：[http://u8c-test.yyuap.com/#/](http://u8c-test.yyuap.com/#/)
- user/password：u8c_vip@163.com     yonyou@1988

登录成功后，即可在cookie中写入token等信息，调用hosts中映射的测试链接时才能通过验证

6.在测试环境找到对应功能节点，并拼凑可访问的 URL

```css
http://guo.yyuap.com:3003/meta/voucherlist/bd_basedocbanklist
```

<a name="0QNgD"></a>
## 四、前端启动命令说明
以下是mdf-app脚手架中的packages.json的启动命令，常用的集成好的如下说明：

| 命令 | 说明 | 后端API地址 |
| --- | --- | --- |
| npm run debug:web | 启动组织中间接口前后端服务 | http://ucf-org-center.daily.app.yyuap.com/ucf-org-center |
| npm run debug:web:ncc | 启动NCC资产云前后端服务 | http://ucf-mdd-amc-pointcheck.daily.app.yyuap.com |
| npm run debug:client | 启动前端工程 | 无 |
| npm run debug:server | 启动node.js服务组织中心 | http://ucf-org-center.daily.app.yyuap.com/ucf-org-center |
| npm run debug:server:daily | 启动node.js资产服务 | http://ucf-mdd-amc-pointcheck.daily.app.yyuap.com |


完成命令集成如下：

```javascript
  "scripts": {
    "_comment_main_start": "================================主要命令区域================================",
    "start:web": "cross-env NODE_ENV=production SERVER_ENV=prod babel-node --only=src,node_modules/@mdf bin/web/server/index.js",
    "start:mobile": "cross-env NODE_ENV=production SERVER_ENV=prod babel-node --only=src,node_modules/@mdf bin/mobile/server/index.js",
    "debug:web": "concurrently \"npm run debug:client\" \"npm run debug:server\"",
    "debug:web:ncc": "concurrently \"npm run debug:client\" \"npm run debug:server:daily\"",
    "debug:mobile": "concurrently \"npm run debug:mobile:client\" \"npm run debug:mobile:server\"",
    "build:web": "concurrently \"npm run build:client\" \"npm run build:server\"",
    "build:mobile": "concurrently \"npm run build:mobile:client\" \"npm run build:mobile:server\"",
    "_comment_main_end": "================================主要命令区域================================",
    "_comment_seperator_": " = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = ",
    "_comment_other_start": "================================其它命令区域================================",
    "start": "cross-env NODE_ENV=production SERVER_ENV=prod babel-node --only=src,node_modules/@mdf bin/web/server/index.js",
    "start:test": "cross-env NODE_ENV=production SERVER_ENV=test babel-node --only=src,node_modules/@mdf bin/web/server/index.js",
    "start:pre": "cross-env NODE_ENV=production SERVER_ENV=pre babel-node --only=src,node_modules/@mdf bin/web/server/index.js",
    "start:daily": "cross-env NODE_ENV=production SERVER_ENV=daily babel-node --only=src,node_modules/@mdf bin/web/server/index.js",
    "start:dev": "cross-env NODE_ENV=production SERVER_ENV=dev babel-node --only=src,node_modules/@mdf bin/web/server/index.js",
    "debug:client": "cross-env BABEL_ENV=development NODE_ENV=development webpack-dev-server --progress --colors  --config webpack.config.js",
    "debug:server": "cross-env BABEL_ENV=production NODE_ENV=development SERVER_ENV=prod nodemon -w src/web/server -w src/web/common --exec babel-node --only=src,node_modules/@mdf --inspect src/web/server/index.js",
    "debug:server:daily": "cross-env BABEL_ENV=production NODE_ENV=development SERVER_ENV=daily nodemon -w src/web/server -w src/web/common --exec babel-node --only=src,node_modules/@mdf --inspect src/web/server/index.js",
    "debug:server:test": "cross-env BABEL_ENV=production NODE_ENV=development SERVER_ENV=test   nodemon -w src/web/server -w src/web/common --exec babel-node --only=src,node_modules/@mdf --inspect src/web/server/index.js",
    "debug:server:dev": "cross-env BABEL_ENV=production NODE_ENV=development SERVER_ENV=dev     nodemon -w src/web/server -w src/web/common --exec babel-node --only=src,node_modules/@mdf --inspect src/web/server/index.js",
    "debug:mobile:client": "cross-env BABEL_ENV=development MDF_TARGET=mobile webpack-dev-server --progress --profile --colors  --config webpack.config.js",
    "debug:mobile:server": "cross-env BABEL_ENV=production NODE_ENV=development MDF_TARGET=mobile nodemon -w src/mobile/server -w src/mobile/common --exec babel-node --only=src,node_modules/@mdf --inspect src/mobile/server/app.mobile.jsx",
    "debug:mobile:server:daily": "cross-env BABEL_ENV=production NODE_ENV=development MDF_TARGET=mobile SERVER_ENV=daily nodemon -w src/mobile/server -w src/mobile/common --exec babel-node --only=src,node_modules/@mdf --inspect src/mobile/server/app.mobile.jsx",
    "build:mobile:client": "cross-env BABEL_ENV=production NODE_ENV=production MDF_TARGET=mobile webpack --config webpack.config.js --colors --progress && echo '移动程序：编译完成'",
    "build:mobile:server": "cross-env BABEL_ENV=production NODE_ENV=production MDF_TARGET=mobile babel src -d bin --ignore client && echo '后端程序：编译完成'",
    "build:dll:dev": "cross-env NODE_ENV=development webpack --config webpack.dll.config.js",
    "build:dll:prod": "cross-env NODE_ENV=production webpack --config webpack.dll.config.js",
    "build:dll": "npm run build:dll:dev && npm run build:dll:prod",
    "build:server": "cross-env BABEL_ENV=production NODE_ENV=production babel src -d bin --ignore client && echo '后端程序：编译完成'",
    "build:client": "cross-env BABEL_ENV=production NODE_ENV=production webpack --config webpack.config.js --colors --progress && echo '前端程序：编译完成'",
    "prebuild": "npm run clean",
    "clean": "rimraf ./bin",
    "_comment_other_end": "================================其它命令区域================================"
  }
```