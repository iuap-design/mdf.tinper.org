<a name="pscLJ"></a>
# 1 功能概述
      目前打印组件实现了打印预览、打印设计、直接打印功能。用户可以在excel中自定义打印按钮的布局。下面是以dropdown形式你实现的。那如何实现打印功能呢，需要用户增加环境变量、excel配置。<br />![image.png](http://design.yonyoucloud.com/static/yuque/0/2019/png/192681/1560390193991-f4ca6df3-5fdb-4bdd-8663-88bdad57a68c.png#align=left&display=inline&height=200&name=image.png&originHeight=400&originWidth=936&search=&size=46212&status=done&width=468)
<a name="oZavH"></a>
# 2 环境变量配置
在src/common/config.env.js 下定义打印相关参数配置如下：<br />**print_url**: 连接打印的后台地址，不同环境地址会不同。具体地址值在备注中有说明。<br />**domainCode**：域code值，不同业务code值不同。具体值可以咨询云打印人员。

<a name="f6428"></a>
# 3 UI元数据配置
首先需要增加打印按钮，配置方式跟普通按钮一样，在Excel中配置[bill_command]表时需要增加paramter、action参数配置。下面为具体的paramter配置说明，其中打印模板printcode、类别编码classifyCode值可向云打印人员咨询。<br />**打印模板printcode**：打印模板是先找云打印人员开通一个数据库，每个领域都有一个，然后总共多少应用下多少个服务需要打印。当我们打开打印模板节点，就能看到模板类别了。<br />**类别编码classifyCode**：可以支持切换同类别下不同模板打印。预置模板的时候，可以打印的字段，是根据类别编码来查的，比如我给的EMM.emm_pcplan_card，他就会查emm_pcplan_card这个页面的所有字段，都可以配置出来，我这边查询也按照emm_pcplan_card来查询，确保他配置的字段我都能查询出来，这样打印才不会出现打印不出来字段情况
<a name="7JXeZ"></a>
#### 
<a name="1CCTR"></a>
## 3.1 打印预览

- paramter对象字段说明
| 属性名称 | 含义 | 备注 |
| --- | --- | --- |
| printcode | 打印模板 | eg:"voucher_system_default_20190515" |
| classifyCode | 类别编码 |  |
| serverUrl | 数据源请求的url，打印时会通过serverUrl请求业务数据 | 可以通过扩展脚本实现，参考下面的扩展API |
| params | 请求业务数据时，会根据此参数进行筛选，具体由业务来定 | 可以通过扩展脚本实现 |
|  |  |  |


<br />整体配置如下：
```javascript
{"printcode":"emm_pcplan_card_print"，"classifyCode":"EMM.emm_pcplan_card"}
```

- action字段说明

      打印预览的action字段为printpreview

<a name="HI23Q"></a>
## 3.2 打印设计

- paramter对象字段说明
| 属性名称 | 含义 | 备注 |
| --- | --- | --- |
| printcode | 打印模板 | eg:"voucher_system_default_20190515_20190515" |


<br />整体配置如下：
```javascript
{"printcode":"voucher_system_default_20190515"}
```

- action字段说明

      打印预览的action字段为printdesign<br />

<a name="9vzwC"></a>
## 3.3 直接打印

- paramter对象字段说明
| **属性名称** | **含义** | **备注** |
| :---: | :---: | :---: |
| printcode | 打印模板 | eg:"voucher_system_default_20190515" |
| serverUrl | 数据源请求的url |  |
| params | 请求数据的参数 | eg:{"metaurl":"bd.currencytenant.CurrencyTenantVO"} |


整体配置如下：
```javascript
{"templateCode": "voucher_system_default_20190515","tenantId": "lfvukx6f",  "params": { "metaurl": "bd.currencytenant.CurrencyTenantVO" },"serverUrl":"http://ucfbasedoc.test.app.yyuap.com/meta/attribute"  }
```


- action字段说明

      打印预览的action字段为printnow

<a name="fDZqa"></a>
# 4 扩展API
beforePrintpreview 打印预览之前的回调，用户可以动态的修改params参数，beforePrintdesign 打印设计之前的回调，用户可以动态的修改params参数，如下：
```javascript
ViewModel.on('beforePrintpreview',(params)=>{

   let cmdParameter = JSON.parse( params.cmdParameter);
   //动态的修改cmdParameter内容
   cmdParameter.serverUrl = '请求数据的url';
   
   cmdParameter.params = '请求数据所需要的参数';
   //例如下面代码：
   //cmdParameter.serverUrl = window.__SERVER_URL__.SRV_URL + "/bill/getPrintData";
   //let billNo = viewmodel.getParams().billNo;
   //const ids = [viewmodel.get("id").getValue()];
   //cmdParameter.params = {
   //   ids: ids, billno: billNo,
   //}
   
   //最后将修改后的内容赋值给params；
   data.params.cmdParameter = JSON.stringify(cmdParameter);

})
```