<a name="Q9en9"></a>
## 机制说明

1、单据模板的 `viewmodel` 在初始化后将上一级模板的 `viewmodel` 设置到缓存字段 `parentViewModel` 中：

```javascript
bill[data.billtype.toLowerCase()].init(data.billno, data.params, function (vm, viewmeta, title) {
      if (viewmodel) {
        vm.setCache('parentViewModel', viewmodel);
        vm.execute('afterInit');
      }
      .....
    });
```

2、这样可以当前单据模板的扩展脚本中都可以通过以下方式拿到缓存数据：

```javascript
const parentViewModel = vm.getCache('parentViewModel');
```


<a name="uUEga"></a>
## 开发指导

<a name="IPuUp"></a>
### 关于 parentViewModel

获取到的 `parentViewModel` 是个普通的 vm 对象，可以像操作其他vm一样去使用，如获取数据、绑定事件、执行操作等。

```javascript
parentViewModel.get(config.key).getValue();
```
<a name="EwuqE"></a>
### 
<a name="B99Ok"></a>
### 刷新

```javascript

const parentViewModel = vm.getCache('parentViewModel');

if (parentViewModel)
	parentViewModel.execute('refresh');
});
```

<a name="YTseV"></a>
### 回退

```javascript
const parentViewModel = viewModel.getCache('parentViewModel');

if (parentViewModel)
  parentViewModel.execute('back');
```

<a name="kw8x3"></a>
### 逐级获取

```javascript
let parentViewModel = viewModel.getCache('parentViewModel');
    if (viewModel.getParams().domain === false) {
      while (parentViewModel.getCache('parentViewModel'))
        parentViewModel = parentViewModel.getCache('parentViewModel');
    }
```

<a name="ao0Wj"></a>
###