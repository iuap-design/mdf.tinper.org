<a name="hZaiY"></a>
# 查询方案扩展
由于查询区的UI元数据不随标准协议接口返回，在单据的扩展脚本的viewmodel中无法获取查询区的字段模型，因此查询区可以增加单独的扩展脚本，在扩展脚本中实现类似模板扩展脚本中的交互。查询区扩展脚本也是放在business文件夹中。
<a name="nbKfH"></a>
## 1 命名规则
查询区的扩展文件名是在excel中配置的。在excel中[pb_meta_filters]表中behaviorObject字段定义当前查询区扩展文件的路径，如果excel中无此列字段可手动添加。查询区扩展脚本也放在子产品编码文件夹下。<br />默认规范：'子产品编码_'+'单据编码_'+'filterVM.Extend.js'。<br />**eg:** EMM_emm_inspectstd_list_filterVM.Extend.js<br />![image.png](http://design.yonyoucloud.com/static/yuque/0/2019/png/271337/1571140914231-019a19ad-b38e-4c81-9241-9e500eda3a79.png#align=left&display=inline&height=148&name=image.png&originHeight=296&originWidth=922&size=34910&status=done&width=461)

** 注：** 查询区扩展脚本定义需加上子产品编码文件夹路径，如：EMM/EMM_emm_inspectstd_list_filterVM.Extend.js

<a name="fmlv7"></a>
## 2 加载流程和逻辑
在查询区的公共脚本（filterViewModel.js）中一段代码用于加载查询区的扩展脚本，如下：

```javascript
proxy.getInitFilterInfo(params, function (errors, results) {
    ......
    if (data && data.behaviorObject && !extendInit) {
        ......
        cb.require([data.behaviorObject], function (extend) {
            extend.doAction('init', viewModel);
            self.extendReady1(viewModel, results, solutionId, viewId);
        }, function (error) {
            console.error(error.message);
            self.extendReady1(viewModel, results, solutionId, viewId);
        })
    }
    ......
});
```

<a name="KxM8q"></a>
## 3 使用方式
查询区扩展脚本的使用方式和单据扩展一致。

```javascript
cb.define([ 'common/common_list_VM.Extend.js' ], function(common) {
    var emm_emm_inspectstd_list_filterVM_Extend = {
        doAction: function(name, viewmodel) {
            if (this[name]) {
                this[name](viewmodel);
            }
        },
        init: function(viewmodel) {
            common.initOrgFilter(viewmodel, 'pk_org');
            common.initCardFilter(viewmodel, 'pk_org', 'pcstdlkvos__pk_equip');
        }
    };
    try {
        module.exports = emm_emm_inspectstd_list_filterVM_Extend;
    } catch (error) {
        console.log(error);
    }
    return emm_emm_inspectstd_list_filterVM_Extend;
});

```


<a name="s2w2e"></a>
## 4、典型场景
点击查询区搜索按钮时，在请求之前修改请求参数。实现根据具体的参数请求数据。

```javascript
cb.define([], function () {
  var PC_pc_productlist_filterVM_Extend = {
    doAction: function (name, viewmodel) {
      if (this[name])
        this[name](viewmodel);
    },
init: function (viewmodel) {
//点击查询区搜索按钮前，将字段参数传入
      viewmodel.on('beforeSearch', function (args) {
         //设置具体的查询条件 
         var condition = {
						"isExtend": true,
						simpleVOs: []
					};
        	//字段stopstatus等于0的数据进行查询
					condition.simpleVOs.push({
						field: 'stopstatus',
						op: 'eq',
						value1: 0
					});
					this.setFilter(condition);
      });
    }
  }
  try {
    module.exports = PC_pc_productlist_filterVM_Extend;
  } catch (error) {

  }
  return PC_pc_productlist_filterVM_Extend;
});

```

args(为请求参数内容)参数说明:<br />commonVOs：需过滤配置了对应的过滤项<br />simpleVOs：根据自己的后台元数据描述